---
title: 小程序 - 图片加载优化
categories: 小程序
tags: 小程序
keywords: [小程序]
description: 图片加载既能图片完成在展示，又能很好的利用浏览器的缓存
---
前一段时间有个生成海报的需求，开始讨论说让前端来生成，所以我以前写过这个，前端生成海报的具体步骤，但是后来发现个别的用户手机就是生成不了，而且我们也不知道具体发生了什么事情，所以考虑到让后端来生成，然后前端只做展示。

调取前端接口，获取海报的url,前端获取到url,赋值给image标签的src属性，但是有一个问题，就是图片如果有点大的时候就会发现，图片是一行一行的加载，相信很多前端同学都遇到过这个问题，为了给用户体验好一点，决定让图片先去加载完成然后在去展示

从后端获取到url ,通过wx.getImageInfo()接口获取到图片的本地路径，然后在把本地路径赋值给图片的src,在展示。

本以为事情到此就结束了，但是后来发现后端做了缓存，第一次的时候有点慢，但是第二次就很快了，但是前段展示还是很慢，突然发现，使用wx.getImageInfo()接口，会每次都去重新下载图片，这样，就没法有效的利用浏览器的缓存，但是如果不用的话，用户体验有不是很好，还好看了看image组件的api,发现image组件提供了一个bindload的方法，也就是图片加载完成后的一个回调，这样就好解决了，我在组件的完成，用v-if方法控制组件的加载，组件里面用v-show方法控制组件的显示，当获取到url,就让组件去加载，然后image组件加载图片完成，在用v-show让组件显示，这样的话就既让用户体验很好，又可以有效的利用浏览器的缓存了。